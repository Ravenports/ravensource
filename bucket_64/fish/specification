DEF[PORTVERSION]=	4.4.0

# if 5u showing at prompt, adjust terminal emulator
# https://github.com/fish-shell/fish-shell/issues/10723
# ----------------------------------------------------------------------------

NAMEBASE=		fish
VERSION=		${PORTVERSION}
KEYWORDS=		rust shells
VARIANTS=		std
SDESC[std]=		Friendly Interactive SHell
HOMEPAGE=		https://fishshell.com/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main cr01 cr02 cr03 cr04 cr05 cr06 cr07 cr08 cr09
			cr10 cr11 cr12 cr13 cr14 cr15 cr16 cr17 cr18 cr19
			cr20 cr21 cr22 cr23 cr24 cr25 cr26 cr27 cr28 cr29
			cr30 cr31 cr32 cr33 cr34 cr35 cr36 cr37 cr38 cr39
			cr40 cr41 cr42 cr43 cr44 cr45 cr46 cr47 cr48 cr49
			cr50 cr51 cr52 cr53 cr54 cr55 cr56 cr57 cr58 cr59
			cr60 cr61 cr62 cr63 cr64 cr65 cr66 cr67 cr68 cr69
			cr70 cr71 cr72 cr73 cr74 cr75 cr76 cr77 cr78 cr79
			cr80 cr81 cr82 cr83 cr84 cr85 cr86 cr87 cr88 cr89
			cr90 cr91 cr92 cr93 cr94 cr95 cr96 cr97 cr98 cr99
			cr100 cr101 cr102 cr103 cr104 cr105 cr106 cr107 cr108 cr109
			cr110 cr111 cr112 cr113 cr114 cr115 cr116 cr117 cr118 cr119
			cr120 cr121 cr122 cr123 cr124
			pcre2
SITES[main]=		https://github.com/fish-shell/fish-shell/releases/download/${PORTVERSION}/
SITES[pcre2]=		GITHUB/fish-shell:rust-pcre2:0.2.9-utf32
SITES[cr01]=		CRATES/aho-corasick:1.1.4
SITES[cr02]=		CRATES/allocator-api2:0.2.21
SITES[cr03]=		CRATES/anstream:0.6.21
SITES[cr04]=		CRATES/anstyle:1.0.13
SITES[cr05]=		CRATES/anstyle-parse:0.2.7
SITES[cr06]=		CRATES/anstyle-query:1.1.5
SITES[cr07]=		CRATES/anstyle-wincon:3.0.11
SITES[cr08]=		CRATES/assert_matches:1.5.0
SITES[cr09]=		CRATES/autocfg:1.5.0
SITES[cr10]=		CRATES/bitflags:2.10.0
SITES[cr11]=		CRATES/block-buffer:0.10.4
SITES[cr12]=		CRATES/bstr:1.12.1
SITES[cr13]=		CRATES/cc:1.2.55
SITES[cr14]=		CRATES/cfg-if:1.0.4
SITES[cr15]=		CRATES/cfg_aliases:0.2.1
SITES[cr16]=		CRATES/clap:4.5.56
SITES[cr17]=		CRATES/clap_builder:4.5.56
SITES[cr18]=		CRATES/clap_derive:4.5.55
SITES[cr19]=		CRATES/clap_lex:0.7.7
SITES[cr20]=		CRATES/colorchoice:1.0.4
SITES[cr21]=		CRATES/cpufeatures:0.2.17
SITES[cr22]=		CRATES/crypto-common:0.1.7
SITES[cr23]=		CRATES/digest:0.10.7
SITES[cr24]=		CRATES/dirs:6.0.0
SITES[cr25]=		CRATES/dirs-sys:0.5.0
SITES[cr26]=		CRATES/either:1.15.0
SITES[cr27]=		CRATES/equivalent:1.0.2
SITES[cr28]=		CRATES/errno:0.3.14
SITES[cr29]=		CRATES/fastrand:2.3.0
SITES[cr30]=		CRATES/find-msvc-tools:0.1.9
SITES[cr31]=		CRATES/fnv:1.0.7
SITES[cr32]=		CRATES/foldhash:0.2.0
SITES[cr33]=		CRATES/generic-array:0.14.7
SITES[cr34]=		CRATES/getrandom:0.2.17
SITES[cr35]=		CRATES/getrandom:0.3.4
SITES[cr36]=		CRATES/globset:0.4.18
SITES[cr37]=		CRATES/hashbrown:0.16.1
SITES[cr38]=		CRATES/heck:0.5.0
SITES[cr39]=		CRATES/is_terminal_polyfill:1.70.2
SITES[cr40]=		CRATES/itertools:0.14.0
SITES[cr41]=		CRATES/jobserver:0.1.34
SITES[cr42]=		CRATES/libc:0.2.180
SITES[cr43]=		CRATES/libredox:0.1.12
SITES[cr44]=		CRATES/lock_api:0.4.14
SITES[cr45]=		CRATES/log:0.4.29
SITES[cr46]=		CRATES/lru:0.16.3
SITES[cr47]=		CRATES/macro_rules_attribute:0.2.2
SITES[cr48]=		CRATES/macro_rules_attribute-proc_macro:0.2.2
SITES[cr49]=		CRATES/memchr:2.7.6
SITES[cr50]=		CRATES/minimal-lexical:0.2.1
SITES[cr51]=		CRATES/nix:0.31.1
SITES[cr52]=		CRATES/nom:7.1.3
SITES[cr53]=		CRATES/num-traits:0.2.19
SITES[cr54]=		CRATES/once_cell:1.21.3
SITES[cr55]=		CRATES/once_cell_polyfill:1.70.2
SITES[cr56]=		CRATES/option-ext:0.2.0
SITES[cr57]=		CRATES/parking_lot:0.12.5
SITES[cr58]=		CRATES/parking_lot_core:0.9.12
SITES[cr59]=		CRATES/paste:1.0.15
SITES[cr60]=		CRATES/phf:0.11.3
SITES[cr61]=		CRATES/phf:0.13.1
SITES[cr62]=		CRATES/phf_codegen:0.11.3
SITES[cr63]=		CRATES/phf_codegen:0.13.1
SITES[cr64]=		CRATES/phf_generator:0.11.3
SITES[cr65]=		CRATES/phf_generator:0.13.1
SITES[cr66]=		CRATES/phf_shared:0.11.3
SITES[cr67]=		CRATES/phf_shared:0.13.1
SITES[cr68]=		CRATES/pkg-config:0.3.32
SITES[cr69]=		CRATES/portable-atomic:1.13.1
SITES[cr70]=		CRATES/ppv-lite86:0.2.21
SITES[cr71]=		CRATES/proc-macro2:1.0.106
SITES[cr72]=		CRATES/quote:1.0.44
SITES[cr73]=		CRATES/r-efi:5.3.0
SITES[cr74]=		CRATES/rand:0.8.5
SITES[cr75]=		CRATES/rand:0.9.2
SITES[cr76]=		CRATES/rand_chacha:0.9.0
SITES[cr77]=		CRATES/rand_core:0.6.4
SITES[cr78]=		CRATES/rand_core:0.9.5
SITES[cr79]=		CRATES/redox_syscall:0.5.18
SITES[cr80]=		CRATES/redox_users:0.5.2
SITES[cr81]=		CRATES/regex-automata:0.4.13
SITES[cr82]=		CRATES/regex-syntax:0.8.8
SITES[cr83]=		CRATES/rsconf:0.3.0
SITES[cr84]=		CRATES/rust-embed:8.11.0
SITES[cr85]=		CRATES/rust-embed-impl:8.11.0
SITES[cr86]=		CRATES/rust-embed-utils:8.11.0
SITES[cr87]=		CRATES/same-file:1.0.6
SITES[cr88]=		CRATES/scc:2.4.0
SITES[cr89]=		CRATES/scopeguard:1.2.0
SITES[cr90]=		CRATES/sdd:3.0.10
SITES[cr91]=		CRATES/serde:1.0.228
SITES[cr92]=		CRATES/serde_core:1.0.228
SITES[cr93]=		CRATES/serde_derive:1.0.228
SITES[cr94]=		CRATES/serial_test:3.3.1
SITES[cr95]=		CRATES/serial_test_derive:3.3.1
SITES[cr96]=		CRATES/sha2:0.10.9
SITES[cr97]=		CRATES/shellexpand:3.1.1
SITES[cr98]=		CRATES/shlex:1.3.0
SITES[cr99]=		CRATES/siphasher:1.0.2
SITES[cr100]=		CRATES/smallvec:1.15.1
SITES[cr101]=		CRATES/strsim:0.11.1
SITES[cr102]=		CRATES/syn:2.0.114
SITES[cr103]=		CRATES/terminfo:0.9.0
SITES[cr104]=		CRATES/thiserror:2.0.18
SITES[cr105]=		CRATES/thiserror-impl:2.0.18
SITES[cr106]=		CRATES/typenum:1.19.0
SITES[cr107]=		CRATES/unicode-ident:1.0.22
SITES[cr108]=		CRATES/unicode-segmentation:1.12.0
SITES[cr109]=		CRATES/unicode-width:0.2.2
SITES[cr110]=		CRATES/unix_path:1.0.1
SITES[cr111]=		CRATES/unix_str:1.0.0
SITES[cr112]=		CRATES/utf8parse:0.2.2
SITES[cr113]=		CRATES/version_check:0.9.5
SITES[cr114]=		CRATES/walkdir:2.5.0
SITES[cr115]=		CRATES/wasi:0.11.1+wasi-snapshot-preview1
SITES[cr116]=		CRATES/wasip2:1.0.1+wasi-0.2.4
SITES[cr117]=		CRATES/widestring:1.2.1
SITES[cr118]=		CRATES/winapi-util:0.1.11
SITES[cr119]=		CRATES/windows-link:0.2.1
SITES[cr120]=		CRATES/windows-sys:0.61.2
SITES[cr121]=		CRATES/wit-bindgen:0.46.0
SITES[cr122]=		CRATES/xterm-color:1.0.2
SITES[cr123]=		CRATES/zerocopy:0.8.37
SITES[cr124]=		CRATES/zerocopy-derive:0.8.37

DISTFILE[1]=		fish-${PORTVERSION}.tar.xz:main
DISTFILE[2]=		generated:cr01
DISTFILE[3]=		generated:cr02
DISTFILE[4]=		generated:cr03
DISTFILE[5]=		generated:cr04
DISTFILE[6]=		generated:cr05
DISTFILE[7]=		generated:cr06
DISTFILE[8]=		generated:cr07
DISTFILE[9]=		generated:cr08
DISTFILE[10]=		generated:cr09
DISTFILE[11]=		generated:cr10
DISTFILE[12]=		generated:cr11
DISTFILE[13]=		generated:cr12
DISTFILE[14]=		generated:cr13
DISTFILE[15]=		generated:cr14
DISTFILE[16]=		generated:cr15
DISTFILE[17]=		generated:cr16
DISTFILE[18]=		generated:cr17
DISTFILE[19]=		generated:cr18
DISTFILE[20]=		generated:cr19
DISTFILE[21]=		generated:cr20
DISTFILE[22]=		generated:cr21
DISTFILE[23]=		generated:cr22
DISTFILE[24]=		generated:cr23
DISTFILE[25]=		generated:cr24
DISTFILE[26]=		generated:cr25
DISTFILE[27]=		generated:cr26
DISTFILE[28]=		generated:cr27
DISTFILE[29]=		generated:cr28
DISTFILE[30]=		generated:cr29
DISTFILE[31]=		generated:cr30
DISTFILE[32]=		generated:cr31
DISTFILE[33]=		generated:cr32
DISTFILE[34]=		generated:cr33
DISTFILE[35]=		generated:cr34
DISTFILE[36]=		generated:cr35
DISTFILE[37]=		generated:cr36
DISTFILE[38]=		generated:cr37
DISTFILE[39]=		generated:cr38
DISTFILE[40]=		generated:cr39
DISTFILE[41]=		generated:cr40
DISTFILE[42]=		generated:cr41
DISTFILE[43]=		generated:cr42
DISTFILE[44]=		generated:cr43
DISTFILE[45]=		generated:cr44
DISTFILE[46]=		generated:cr45
DISTFILE[47]=		generated:cr46
DISTFILE[48]=		generated:cr47
DISTFILE[49]=		generated:cr48
DISTFILE[50]=		generated:cr49
DISTFILE[51]=		generated:cr50
DISTFILE[52]=		generated:cr51
DISTFILE[53]=		generated:cr52
DISTFILE[54]=		generated:cr53
DISTFILE[55]=		generated:cr54
DISTFILE[56]=		generated:cr55
DISTFILE[57]=		generated:cr56
DISTFILE[58]=		generated:cr57
DISTFILE[59]=		generated:cr58
DISTFILE[60]=		generated:cr59
DISTFILE[61]=		generated:cr60
DISTFILE[62]=		generated:cr61
DISTFILE[63]=		generated:cr62
DISTFILE[64]=		generated:cr63
DISTFILE[65]=		generated:cr64
DISTFILE[66]=		generated:cr65
DISTFILE[67]=		generated:cr66
DISTFILE[68]=		generated:cr67
DISTFILE[69]=		generated:cr68
DISTFILE[70]=		generated:cr69
DISTFILE[71]=		generated:cr70
DISTFILE[72]=		generated:cr71
DISTFILE[73]=		generated:cr72
DISTFILE[74]=		generated:cr73
DISTFILE[75]=		generated:cr74
DISTFILE[76]=		generated:cr75
DISTFILE[77]=		generated:cr76
DISTFILE[78]=		generated:cr77
DISTFILE[79]=		generated:cr78
DISTFILE[80]=		generated:cr79
DISTFILE[81]=		generated:cr80
DISTFILE[82]=		generated:cr81
DISTFILE[83]=		generated:cr82
DISTFILE[84]=		generated:cr83
DISTFILE[85]=		generated:cr84
DISTFILE[86]=		generated:cr85
DISTFILE[87]=		generated:cr86
DISTFILE[88]=		generated:cr87
DISTFILE[89]=		generated:cr88
DISTFILE[90]=		generated:cr89
DISTFILE[91]=		generated:cr90
DISTFILE[92]=		generated:cr91
DISTFILE[93]=		generated:cr92
DISTFILE[94]=		generated:cr93
DISTFILE[95]=		generated:cr94
DISTFILE[96]=		generated:cr95
DISTFILE[97]=		generated:cr96
DISTFILE[98]=		generated:cr97
DISTFILE[99]=		generated:cr98
DISTFILE[100]=		generated:cr99
DISTFILE[101]=		generated:cr100
DISTFILE[102]=		generated:cr101
DISTFILE[103]=		generated:cr102
DISTFILE[104]=		generated:cr103
DISTFILE[105]=		generated:cr104
DISTFILE[106]=		generated:cr105
DISTFILE[107]=		generated:cr106
DISTFILE[108]=		generated:cr107
DISTFILE[109]=		generated:cr108
DISTFILE[110]=		generated:cr109
DISTFILE[111]=		generated:cr110
DISTFILE[112]=		generated:cr111
DISTFILE[113]=		generated:cr112
DISTFILE[114]=		generated:cr113
DISTFILE[115]=		generated:cr114
DISTFILE[116]=		generated:cr115
DISTFILE[117]=		generated:cr116
DISTFILE[118]=		generated:cr117
DISTFILE[119]=		generated:cr118
DISTFILE[120]=		generated:cr119
DISTFILE[121]=		generated:cr120
DISTFILE[122]=		generated:cr121
DISTFILE[123]=		generated:cr122
DISTFILE[124]=		generated:cr123
DISTFILE[125]=		generated:cr124
DISTFILE[126]=		generated:pcre2
DIST_SUBDIR=		rust/crates
DF_INDEX=		1 2 3 4 5 6 7 8 9 10
			11 12 13 14 15 16 17 18 19 20
			21 22 23 24 25 26 27 28 29 30
			31 32 33 34 35 36 37 38 39 40
			41 42 43 44 45 46 47 48 49 50
			51 52 53 54 55 56 57 58 59 60
			61 62 63 64 65 66 67 68 69 70
			71 72 73 74 75 76 77 78 79 80
			81 82 83 84 85 86 87 88 89 90
			91 92 93 94 95 96 97 98 99 100
			101 102 103 104 105 106 107 108 109 110
			111 112 113 114 115 116 117 118 119 120
			121 122 123 124 125
			126

SPKGS[std]=		set primary dev docs man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

LICENSE=		GPLv2:primary
LICENSE_TERMS=		primary:{{WRKSRC}}/COPYING
LICENSE_FILE=		GPLv2:stock
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		shells/fish

BUILD_DEPENDS=		python-Sphinx:single:python_used
			rust:single:std

USES=			cmake cpe ncurses shebangfix python:build
			pcre2 gettext c++:primary
CPE_VENDOR=		fishshell
SHEBANG_FILES=		share/tools/*.py
			share/tools/web_config/webconfig.py
CMAKE_ARGS=		-DWITH_MESSAGE_LOCALIZATION:BOOL=ON
MANDIRS=		{{PREFIX}}/share/fish/man/man1

VAR_OPSYS[sunos]=	LDFLAGS=-lintl
BROKEN[netbsd]=		nix crate error:  expected raw pointer `*mut c_void`, fount_type `isize`

post-install:
.for i in fish fish_indent fish_key_reader
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/${i}
.endfor
	${RMDIR} ${STAGEDIR}${PREFIX}/share/doc/fish/_sources

pre-configure:
	${MKDIR} ${DOTCARGO}
	@${ECHO_CMD} "[source.cargo]" > ${CFGTOML}
	@${ECHO_CMD} "directory = '${WRKSRC}/cargo-crates'" >> ${CFGTOML}
	@${ECHO_CMD} "[source.crates-io]" >> ${CFGTOML}
	@${ECHO_CMD} "replace-with = 'cargo'" >> ${CFGTOML}
