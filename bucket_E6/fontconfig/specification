DEF[PORTVERSION]=	2.14.1
DEF[SOVERSION]=		1.12.0
# ----------------------------------------------------------------------------

NAMEBASE=		fontconfig
VERSION=		${PORTVERSION}
KEYWORDS=		x11_fonts
VARIANTS=		standard
SDESC[standard]=	XML-based font configuration API for X Windows
HOMEPAGE=		http://www.freedesktop.org/wiki/Software/fontconfig
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://www.freedesktop.org/software/fontconfig/release/
DISTFILE[1]=		fontconfig-${PORTVERSION}.tar.xz:main

SPKGS[standard]=	complete primary docs

OPTIONS_AVAILABLE=	HINTING_NONE HINTING_SLIGHT HINTING_MEDIUM HINTING_FULL
			NO_BITMAPS
OPTIONS_STANDARD=	HINTING_NONE HINTING_SLIGHT HINTING_MEDIUM HINTING_FULL
			NO_BITMAPS
OPTGROUP_RADIO=		HINTING
OPTDESCR[HINTING]=	Preferred pixel hinting configuration
OPTGROUP[HINTING]=	HINTING_NONE HINTING_SLIGHT HINTING_MEDIUM HINTING_FULL
OPT_ON[all]=		HINTING_SLIGHT

LICENSE=		MIT:primary
LICENSE_FILE=		MIT:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		solo

# FPC is using dev version so break link
# FPC_EQUIVALENT=		x11-fonts/fontconfig

BUILD_DEPENDS=		gperf:primary:standard
BUILDRUN_DEPENDS=	freetype:primary:standard

USES=			cpe gmake libtool pkgconfig python:build expat zlib:build
MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-configdir={{PREFIX}}/etc/fonts/conf.d
			--with-templatedir={{PREFIX}}/etc/fonts/conf.avail
			--with-xmldir={{PREFIX}}/etc/fonts
			--with-expat-includes={{LOCALBASE}}/include
			--with-expat-lib={{LOCALBASE}}/lib
			--with-default-hinting={{PREFERRED_HINTING}}
			--with-default-fonts={{PREFIX}}/share/fonts
			--with-add-fonts={{LOCALBASE}}/lib/X11/fonts
			--with-cache-dir=/var/db/fontconfig
			--enable-nls=no
			--disable-docs
			--enable-static

# Python is not required, because fc-blanks.h is available in distfile
CONFIGURE_ENV=		PYTHON=":"
INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
CPE_VENDOR=		fontconfig_project

SUB_FILES=		pkg-install-primary
PLIST_SUB=		PREFERRED_HINTING={{PREFERRED_HINTING}}
SOVERSION=		${SOVERSION}

[HINTING_NONE].DESCRIPTION=		No hinting
[HINTING_SLIGHT].DESCRIPTION=		Slight hinting
[HINTING_MEDIUM].DESCRIPTION=		Medium hinting
[HINTING_FULL].DESCRIPTION=		Full hinting
[NO_BITMAPS].DESCRIPTION=		Reject bitmap fonts by default

[HINTING_NONE].MAKEFILE_ON=		PREFERRED_HINTING=none
[HINTING_SLIGHT].MAKEFILE_ON=		PREFERRED_HINTING=slight
[HINTING_MEDIUM].MAKEFILE_ON=		PREFERRED_HINTING=medium
[HINTING_FULL].MAKEFILE_ON=		PREFERRED_HINTING=full

post-patch-NO_BITMAPS-ON:
	${SED} -i'.bitmaps.bak' -e \
		'/^CONF_LINKS =/s|$$|\${.newline}       70-no-bitmaps.conf \\|' \
		${WRKSRC}/conf.d/Makefile.in

post-install:
	@${MKDIR} ${STAGEDIR}${STD_DOCDIR}
	${INSTALL_MAN} ${WRKSRC}/fc-*/*.1 \
		${STAGEDIR}${MANPREFIX}/man/man1
	${INSTALL_MAN} ${WRKSRC}/doc/*.5 \
		${STAGEDIR}${MANPREFIX}/man/man5
	${INSTALL_DATA} ${WRKSRC}/fonts.conf \
		${STAGEDIR}${PREFIX}/etc/fonts/fonts.conf.sample
.for doc in fontconfig-user.html fontconfig-user.pdf fontconfig-user.txt
	${INSTALL_DATA} ${WRKSRC}/doc/${doc} ${STAGEDIR}${STD_DOCDIR}/
.endfor
