DEF[PORTVERSION]=	0.4.3
# ----------------------------------------------------------------------------

NAMEBASE=		anet
VERSION=		${PORTVERSION}
KEYWORDS=		net
VARIANTS=		standard
SDESC[standard]=	Networking library for Ada
HOMEPAGE=		https://www.codelabs.ch/anet/
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://www.codelabs.ch/download/
DISTFILE[1]=		libanet-${PORTVERSION}.tar.bz2:main

SPKGS[standard]=	complete primary docs

OPTIONS_AVAILABLE=	TESTED BSD
OPTIONS_STANDARD=	TESTED BSD
OPT_ON[dragonfly]=	BSD
OPT_ON[freebsd]=	BSD
OPT_ON[netbsd]=		BSD
OPT_ON[midnightbsd]=	BSD

LICENSE=		GMGPL:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GMGPL:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^pragma"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/anet.ads
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		net/anet

BUILD_DEPENDS=		ruby-asciidoctor:single:ruby_default
			source-highlight:primary:standard

USES=			gprbuild gmake ada:primary
BUILD_TARGET=		all build-doc
DISTNAME=		libanet-${PORTVERSION}
MAKE_ARGS=		NUM_CPUS={{MAKE_JOBS_NUMBER}}
INSTALL_REQ_TOOLCHAIN=	yes

[TESTED].DESCRIPTION=			Run unit test suite before installation
[TESTED].BUILD_DEPENDS_ON=		ahven:primary:standard
[TESTED].BUILD_TARGET_ON=		tests

[BSD].DESCRIPTION=			Build on BSD platform
[BSD].EXTRA_PATCHES_ON=			extra-src_anet-sockets-inet.adb
[BSD].MAKE_ARGS_ON=			OS=bsd

pre-configure:
	${REINPLACE_CMD} -e 's|=lib/gnat|=share/gpr|' ${WRKSRC}/Makefile
	${REINPLACE_CMD} -e 's|"dynamic"|"static-pic"|' ${WRKSRC}/anet.gpr

post-install:
	(cd ${WRKSRC}/doc && ${COPYTREE_SHARE} html ${STAGEDIR}${STD_DOCDIR})
