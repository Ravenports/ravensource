# Manually maintained because wheel files required pip to install
# There are no distfiles because python's ensurepip bootstraps it.
# When the newest python branch is updated, update the portversion accordingly
#
# From ENTERAFTER=install, `pip --version`
# pip 25.2 from /raven/lib/python3.11/site-packages/pip (python 3.13)
# pip xxxx from /raven/lib/python3.11/site-packages/pip (python 3.14)
#
DEF[PORTVERSION]=	EXTRACT_VERSION(PIP_3.13_VERSION)
DEF[EXMTREE]=		/etc/mtree.preconfig.exclude
# ------------------------------------------------------------------------

NAMEBASE=		python-pip
VERSION=		${PORTVERSION}
KEYWORDS=		python
VARIANTS=		v13 v14
SDESC[v13]=		Tool for installing python packages (3.13)
SDESC[v14]=		Tool for installing python packages (3.14)
HOMEPAGE=		https://pip.pypa.io/
CONTACT=		Python_Automaton[python@ironwolf.systems]

DOWNLOAD_GROUPS=	none

SPKGS[v13]=		single
SPKGS[v14]=		single

OPTIONS_AVAILABLE=	PY313 PY314
OPTIONS_STANDARD=	none
VOPTS[v13]=		PY313=ON PY314=OFF
VOPTS[v14]=		PY313=ON PY314=ON

# License listed at PyPI
# MIT

GENERATED=		yes

# install_requires extracted from setup.py

USES=			cpe
CPE_VENDOR=		pypa
CPE_PRODUCT=		pip

[PY313].USES_ON=			python:v13
[PY313].MAKEFILE_ON=			POST_PLIST_TARGET+=setuptools-autolist
[PY314].USES_ON=			python:v14
[PY314].MAKEFILE_ON=			POST_PLIST_TARGET+=setuptools-autolist
[PY314].DESCRIPTION=			Build on python 3.14 (delete me)

do-build:
	# By using --user, the pyc files are hardcoded with the wrong paths.
	# those will have to be regenerated
	${PYTHON_CMD} -m ensurepip --user

do-install:
	${RM} -r ${STAGEDIR}
	${MKDIR} ${STAGEDIR}
	${FIND} /root/.local/ -type d -name __pycache__ | xargs rm -rf
	${RM} /root/.local/bin/pip3
	${MV} /root/.local ${STAGEDIR}${PREFIX}

post-install:
	(cd ${STAGEDIR} && ${PYTHON_CMD} -m compileall -d / . ||:)
