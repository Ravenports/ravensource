DEF[PORTVERSION]=	2.0.0
DEF[DISTFILE_VER]=	${PORTVERSION}
DEF[SOVERSION]=		320.0.0
DEF[CPP_SOVERSION]=	320.0.0
DEF[HDF5_FORT_SOVER]=	320.0.0
DEF[HL_SOVER]=		320.0.0
DEF[HL_FORT_SOVER]=	320.0.0
# ----------------------------------------------------------------------------

NAMEBASE=		hdf5
VERSION=		${PORTVERSION}
REVISION=		1
KEYWORDS=		archivers science
VARIANTS=		std
SDESC[std]=		General purpose file format for scientific data
HOMEPAGE=		https://www.hdfgroup.org/solutions/hdf5/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/HDFGroup/hdf5/releases/download/${PORTVERSION}/
DISTFILE[1]=		hdf5-${DISTFILE_VER}.tar.gz:main

SPKGS[std]=		set primary cxx fort tools dev
# drop "examples" subpackage (not longer installed)

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

LICENSE=		BSD3CLAUSE:primary
LICENSE_FILE=		BSD3CLAUSE:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		science/hdf5

EXRUN[tools]=		hdf5:primary:std
EXRUN[cxx]=		hdf5:primary:std
EXRUN[fort]=		hdf5:primary:std

USES=			cpe cmake zlib c++:cxx fortran:fort
CPE_VENDOR=		hdfgroup
CMAKE_ARGS=		-DBUILD_SHARED_LIBS:BOOL=ON
			-DBUILD_STATIC_LIBS:BOOL=ON
			-DBUILD_TESTING:BOOL=OFF
			-DHDF5_BUILD_EXAMPLES:BOOL=ON
			-DHDF5_BUILD_FORTRAN:BOOL=ON
			-DHDF5_BUILD_CPP_LIB:BOOL=ON
			-DHDF5_ENABLE_ZLIB_SUPPORT:BOOL=ON
SOVERSION=		${SOVERSION}
PLIST_SUB=		HL_SOVER=${HL_SOVER}
			HL_SOMAJOR=${HL_SOVER:R:R}
			HDF5_FORT_SOVER=${HDF5_FORT_SOVER}
			HDF5_FORT_SOMAJOR=${HDF5_FORT_SOVER:R:R}
			HL_FORT_SOVER=${HL_FORT_SOVER}
			HL_FORT_SOMAJOR=${HL_FORT_SOVER:R:R}
			CPP_SOVERSION=${CPP_SOVERSION}
			CPP_SOMAJOR=${CPP_SOVERSION:R:R}
DISTNAME=		hdf5-${DISTFILE_VER}

pre-configure:
	# fix isnan
	${REINPLACE_CMD} -e 's|= isnan(|= __builtin_isnan(|g' \
		${WRKSRC}/tools/lib/h5diff_array.c

post-install:
	# remove garbage
	${RM} ${STAGEDIR}${PREFIX}/share/LICENSE
	${RM} ${STAGEDIR}${PREFIX}/share/CHANGELOG.md
	${RM} ${STAGEDIR}${PREFIX}/share/USING_HDF5_CMake.txt

	# strip things
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/lib*.so
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/*
