DEF[PORTVERSION]=	4.5.2
DEF[SOVERSION]=		21.0.0
# ----------------------------------------------------------------------------

NAMEBASE=		libwebsockets
VERSION=		${PORTVERSION}
KEYWORDS=		net devel
VARIANTS=		std
SDESC[std]=		Lightweight C library for Websockets
HOMEPAGE=		https://libwebsockets.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/warmcat:libwebsockets:v${PORTVERSION}
DISTFILE[1]=		generated:main

SPKGS[std]=		set primary dev

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

LICENSE=		MIT:primary
LICENSE_FILE=		MIT:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		net/libwebsockets

BUILD_DEPENDS=		libuv:dev:std
BUILDRUN_DEPENDS=	libuv:primary:std

USES=			cmake pkgconfig zlib ssl
SOVERSION=		${SOVERSION}
CMAKE_ARGS=		-DLWS_BUILD_HASH:STRING="{{CONFIGURE_TARGET}}"
			-DCMAKE_DISABLE_FIND_PACKAGE_Git:BOOL=ON
			-DDISABLE_WERROR:BOOL=ON
			-DLWS_WITH_DISKCACHE:BOOL=ON
			-DLWS_WITH_FTS:BOOL=ON
			-DLWS_IPV6:BOOL=ON
			-DLWS_WITH_RANGES:BOOL=ON
			-DLWS_WITH_SSL:BOOL=ON
			-DLWS_WITH_THREADPOOL:BOOL=ON
			-DLWS_WITH_ZLIB:BOOL=ON
			-DLWS_WITHOUT_BUILTIN_SHA1:BOOL=ON
			-DLWS_WITHOUT_TESTAPPS:BOOL=ON
			-DLWS_WITHOUT_TEST_SERVER:BOOL=ON
			-DLWS_WITH_HTTP2:BOOL=ON
			-DLWS_ROLE_MQTT:BOOL=ON
			-DLWS_WITH_EXTERNAL_POLL:BOOL=ON
			-DLWS_WITH_HTTP_PROXY:BOOL=ON
			-DLWS_WITH_SECURE_STREAMS:BOOL=ON
			-DLWS_WITH_SECURE_STREAMS_PROXY_API:BOOL=ON
			-DLWS_WITH_SOCKS5:BOOL=ON
			-DLWS_WITH_LIBUV:BOOL=ON
			-DLWS_WITH_GLIB:BOOL=OFF
			-DLWS_WITH_LIBEV:BOOL=OFF
			-DLWS_WITH_LIBEVENT:BOOL=OFF
			-DLWS_WITH_MBEDTLS:BOOL=OFF
			-DLWS_WITH_PEER_LIMITS:BOOL=OFF
			-DLWS_WITH_PLUGINS:BOOL=OFF
			-DLWS_WITH_PLUGINS_API:BOOL=OFF
			-DLWS_WITH_SQLITE3:BOOL=OFF
			-DLWS_WITH_LWSWS:BOOL=OFF

# #			cmake detection overrides
			-DLWS_HAVE_HMAC_CTX_new:BOOL=ON
			-DLWS_HAVE_EVP_MD_CTX_free:BOOL=ON
			-DLWS_HAVE_SSL_EXTRA_CHAIN_CERTS:BOOL=ON

CFLAGS=			-I{{OPENSSLINC}}
LDFLAGS=		-D{{OPENSSLLIB}}

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/lib*.so
