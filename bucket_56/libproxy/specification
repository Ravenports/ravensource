DEF[PORTVERSION]=	0.4.13
# ----------------------------------------------------------------------------

NAMEBASE=		libproxy
VERSION=		${PORTVERSION}
KEYWORDS=		net devel
VARIANTS=		standard minimal
SDESC[standard]=	Library for automatic proxy configuration mgmt
SDESC[minimal]=		Libproxy without any additional bindings
HOMEPAGE=		https://libproxy.github.io/libproxy
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/libproxy/libproxy/archive/
DISTFILE[1]=		${PORTVERSION}.tar.gz:main

SPKGS[standard]=	single
SPKGS[minimal]=		single

OPTIONS_AVAILABLE=	PERL524 PERL526 PY27 PY35 PY36 VALA
OPTIONS_STANDARD=	PERL526 PY36 VALA
# Other bindings not currently available in Raven:
# Mono, GConf, GSettings, kreadconfig, kreadconfig5, MozJS,
# NetworkManager, Webkit, Webkit2

FPC_EQUIVALENT=		net/libproxy

USES=			cclibs:single c++:single cmake pkgconfig

VOPTS[minimal]=		PERL524=OFF PERL526=OFF PY27=OFF PY35=OFF
			PY36=OFF VALA=OFF
# Other variants may be feasible in the future as deps become available

[PERL524].DESCRIPTION=			Build with Perl (5.24) binding
[PERL526].DESCRIPTION=			Build with Perl (5.26) binding
[PY27].DESCRIPTION=			Build with Python (2.7) binding
[PY35].DESCRIPTION=			Build with Python (3.5) binding
[PY36].DESCRIPTION=			Build with Python (3.6) binding
[VALA].DESCRIPTION=			Build with Vala binding

CMAKE_ARGS=		-DBIPR:BOOL=OFF
			-DWITH_DOTNET:BOOL=OFF
			-DWITH_NATUS:BOOL=OFF
			-DWITH_NM:BOOL=OFF
			-DWITH_GNOME2:BOOL=OFF
			-DWITH_GNOME3:BOOL=OFF
			-DWITH_KDE:BOOL=OFF
			-DWITH_MOZJS:BOOL=OFF
			-DWITH_PERL:BOOL=OFF
			-DWITH_PYTHON2:BOOL=OFF
			-DWITH_PYTHON3:BOOL=OFF
			-DWITH_WEBKIT:BOOL=OFF
			-DWITH_WEBKIT3:BOOL=OFF

[PERL524].USES_ON=			perl:524
[PERL524].CMAKE_ARGS_ON=		-DWITH_PERL:BOOL=ON
[PERL526].USES_ON=			perl:526
[PERL526].CMAKE_ARGS_ON=		-DWITH_PERL:BOOL=ON
[PY27].USES_ON=				python:27
[PY27].CMAKE_ARGS_ON=			-DWITH_PYTHON2:BOOL=ON
					-DPYTHON_SITEPKG_DIR=/lib/python2.7/site-packages
[PY35].USES_ON=				python:35
[PY35].CMAKE_ARGS_ON=			-DWITH_PYTHON3:BOOL=ON
					-DPYTHON_SITEPKG_DIR=/lib/python3.5/site-packages
[PY36].USES_ON=				python:36
[PY36].CMAKE_ARGS_ON=			-DWITH_PYTHON3:BOOL=ON
					-DPYTHON_SITEPKG_DIR=/lib/python3.6/site-packages
[VALA].BUILDRUN_DEPENDS_ON=		vala:single:standard
[VALA].CMAKE_ARGS_ON=			-DWITH_VALA:BOOL=ON
[VALA].CMAKE_ARGS_OFF=			-DWITH_VALA:BOOL=OFF

post-stage:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/proxy
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libproxy.so.*
	test -d ${STAGEDIR}/lib && ${MV} ${STAGEDIR}/lib/* ${STAGEDIR}${PREFIX}/lib || true
	test -d ${STAGEDIR}/lib && ${RM} -r ${STAGEDIR}/lib || true

