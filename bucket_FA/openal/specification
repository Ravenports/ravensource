DEF[PORTVERSION]=	1.21.0
DEF[SOVERSION]=		${PORTVERSION}
# ----------------------------------------------------------------------------

NAMEBASE=		openal
VERSION=		${PORTVERSION}
KEYWORDS=		audio
VARIANTS=		standard
SDESC[standard]=	Cross-platform 3D audio API
HOMEPAGE=		https://www.openal-soft.org
CONTACT=		Leonid_Bobrov[goleo@disroot.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/kcat:openal-soft:openal-soft-${PORTVERSION}
DISTFILE[1]=		generated:main

SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

LICENSE=		LGPL20+:single
LICENSE_FILE=		LGPL20+:{{WRKSRC}}/COPYING
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_AWK=		TERMS:"^\#include"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/alc/alc.cpp
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		audio/openal-soft

USES=			c++:single cmake zlib gmake
CMAKE_ARGS=		-DALSOFT_DLOPEN=Off
			-DALSOFT_UTILS=On
			-DALSOFT_EXAMPLES=Off
			-DALSOFT_REQUIRE_SNDIO=On
			-DALSOFT_BACKEND_WAVE=Off
			-DALSOFT_CPUEXT_SSE=Off
			-DALSOFT_CPUEXT_SSE2=Off
			-DALSOFT_CPUEXT_SSE3=Off
			-DALSOFT_CPUEXT_SSE4_1=Off
			-DCMAKE_DISABLE_FIND_PACKAGE_ALSA:Bool=Yes
			-DCMAKE_DISABLE_FIND_PACKAGE_AudioIO:Bool=Yes
			-DCMAKE_DISABLE_FIND_PACKAGE_JACK:Bool=Yes
			-DCMAKE_DISABLE_FIND_PACKAGE_OSS:Bool=Yes
			-DCMAKE_DISABLE_FIND_PACKAGE_PortAudio:Bool=Yes
			-DCMAKE_DISABLE_FIND_PACKAGE_PulseAudio:Bool=Yes
			-DCMAKE_DISABLE_FIND_PACKAGE_QSA:Bool=Yes
			-DALSOFT_NO_CONFIG_UTIL=On
CMAKE_BUILD_TYPE=	Release
BUILDRUN_DEPENDS=	sndio:single:standard
SOVERSION=		${SOVERSION}
INSTALL_REQ_TOOLCHAIN=	yes

VAR_OPSYS[sunos]=	CFLAGS=-D__EXTENSIONS__
			LDFLAGS=-lrt

post-patch:
	${REINPLACE_CMD} 's|/etc/openal|${PREFIX}/etc/openal|' \
		${WRKSRC}/alc/alconfig.cpp

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libopenal.so
